# üöÄ BRIEF NOUVEAU PROJET - MANALYTICS-CLEAN

> **Document de transition pour nouvelle IA** - Cr√©ation d'un pipeline MTG Analytics moderne et propre

## üìã **CONTEXTE & OBJECTIF**

### **Situation actuelle**
- Projet Manalytics existant avec architecture hybride Python/R **CASS√âE**
- Int√©gration fbettega bloqu√©e depuis des mois
- D√©pendances manquantes critiques (`requirements.txt` absent)
- Code legacy complexe (4494 lignes orchestrateur)
- Pipeline fonctionnel mais limit√© √† 20,699 decks statiques

### **Objectif du nouveau projet**
Cr√©er **Manalytics-Clean** : pipeline MTG moderne, propre et fonctionnel reproduisant les r√©sultats de l'√©cosyst√®me Jilliac/Fbettega.

## üéØ **INFRASTRUCTURE JILLIAC/FBETTEGA √Ä REPRODUIRE**

### **Architecture compl√®te de r√©f√©rence (OBLIGATOIRE √Ä MA√éTRISER)**
```mermaid
graph TB
    subgraph "Step 1: Data Collection"
        A1[MTGO Platform] -->|Scrapes decklists| B1[mtg_decklist_scrapper<br/>github.com/fbettega/mtg_decklist_scrapper]
        B1 -->|Stores raw data| C1[MTG_decklistcache<br/>github.com/fbettega/MTG_decklistcache]

        A2[MTGO Client] -->|Listens for matchups| D1[MTGO-listener<br/>github.com/Jiliac/MTGO-listener]
        D1 -->|Uses SDK| E1[MTGOSDK<br/>github.com/videre-project/MTGOSDK]

        C1 -->|Combined with| F1[MTGODecklistCache<br/>github.com/Jiliac/MTGODecklistCache]
        D1 -->|Matchup data| F1

        G1[Legacy: MTGODecklistCache.Tools<br/>github.com/Badaro/MTGODecklistCache.Tools<br/>‚ö†Ô∏è Retired by Badaro] -.->|Replaced by| B1
    end

    subgraph "Step 2: Data Treatment"
        F1 -->|Raw lists| H2[MTGOArchetypeParser<br/>github.com/Badaro/MTGOArchetypeParser]
        I2[MTGOFormatData<br/>github.com/Badaro/MTGOFormatData<br/>Archetype Rules] -->|Defines parsing logic| H2
        H2 -->|Categorized by archetype| J2[Processed Data<br/>by Format]

        K2[Maintainers:<br/>- Jiliac: Most formats<br/>- iamactuallylvl1: Vintage] -->|Maintains rules| I2
    end

    subgraph "Step 3: Visualization"
        J2 -->|Archetype data| L3[R-Meta-Analysis Fork<br/>github.com/Jiliac/R-Meta-Analysis]
        L3 -->|Generates| M3[Matchup Matrix<br/>Like the image shown]
        M3 -->|Published to| N3[Discord]

        O3[Original: R-Meta-Analysis<br/>github.com/Aliquanto3/R-Meta-Analysis<br/>‚ö†Ô∏è Aliquanto left] -.->|Forked to| L3
    end

    style A1 fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style A2 fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style F1 fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    style J2 fill:#c8e6c9,stroke:#1b5e20,stroke-width:3px
    style M3 fill:#ffcdd2,stroke:#c62828,stroke-width:3px
    style G1 fill:#ffebee,stroke:#b71c1c,stroke-width:1px,stroke-dasharray: 5 5
    style O3 fill:#ffebee,stroke:#b71c1c,stroke-width:1px,stroke-dasharray: 5 5

    classDef dataSource fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef processing fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef output fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef retired fill:#eceff1,stroke:#455a64,stroke-width:1px,stroke-dasharray: 5 5
```

### **üö® PR√âREQUIS OBLIGATOIRES AVANT D√âVELOPPEMENT**

**AUCUN CODE NE DOIT √äTRE √âCRIT AVANT D'AVOIR :**

1. **üìö √âTUDI√â EN PROFONDEUR tous les repositories Discord cit√©s :**
   - `github.com/fbettega/mtg_decklist_scrapper`
   - `github.com/fbettega/MTG_decklistcache`
   - `github.com/Jiliac/MTGO-listener`
   - `github.com/videre-project/MTGOSDK`
   - `github.com/Jiliac/MTGODecklistCache`
   - `github.com/Badaro/MTGOArchetypeParser`
   - `github.com/Badaro/MTGOFormatData`
   - `github.com/Jiliac/R-Meta-Analysis`
   - `github.com/Aliquanto3/R-Meta-Analysis`

2. **üîç MA√éTRIS√â PARFAITEMENT :**
   - Les processus de scraping utilis√©s
   - Les m√©thodes de classification d'arch√©types
   - Les algorithmes de calcul de matchups
   - Les formats de donn√©es √† chaque √©tape
   - Les m√©triques statistiques calcul√©es
   - Les m√©thodes de visualisation

3. **üìä ANALYS√â LES DONN√âES DE R√âF√âRENCE :**
   - Donn√©es Jilliac p√©riode 1er juillet - 15 juillet 2025
   - Format exact des outputs attendus
   - M√©triques de comparaison

## üèóÔ∏è **ARCHITECTURE MODERNE RECOMMAND√âE**

### **Structure projet**
```
manalytics-clean/
‚îú‚îÄ‚îÄ requirements.txt              # D√©pendances claires et minimales
‚îú‚îÄ‚îÄ config.yaml                  # Configuration centralis√©e
‚îú‚îÄ‚îÄ README.md                     # Documentation claire
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # Point d'entr√©e principal
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py           # Gestion configuration
‚îÇ   ‚îú‚îÄ‚îÄ scrapers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_scraper.py       # Interface commune
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mtgo_scraper.py       # Scraper MTGO natif
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ melee_scraper.py      # Scraper Melee (avec credentials)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ topdeck_scraper.py    # Scraper TopDeck natif
‚îÇ   ‚îú‚îÄ‚îÄ classifiers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ archetype_classifier.py # MTGOFormatData integration
‚îÇ   ‚îú‚îÄ‚îÄ analytics/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metagame_analyzer.py  # Analyses statistiques
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ matchup_calculator.py # Calculs matchups
‚îÇ   ‚îú‚îÄ‚îÄ visualizations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ charts_generator.py   # Graphiques Plotly
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboard_builder.py  # Dashboard HTML
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ data_validator.py     # Validation donn√©es
‚îÇ       ‚îî‚îÄ‚îÄ cache_manager.py      # Gestion cache
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ raw/                      # Donn√©es brutes scraped
‚îÇ   ‚îú‚îÄ‚îÄ processed/                # Donn√©es trait√©es
‚îÇ   ‚îî‚îÄ‚îÄ cache/                    # Cache intelligent
‚îú‚îÄ‚îÄ outputs/                      # R√©sultats g√©n√©r√©s
‚îÇ   ‚îú‚îÄ‚îÄ analyses/                 # Analyses par p√©riode
‚îÇ   ‚îî‚îÄ‚îÄ dashboards/               # Dashboards HTML
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_scrapers.py
‚îÇ   ‚îú‚îÄ‚îÄ test_classifiers.py
‚îÇ   ‚îî‚îÄ‚îÄ test_analytics.py
‚îî‚îÄ‚îÄ credentials/                  # Credentials chiffr√©s (Melee)
    ‚îî‚îÄ‚îÄ melee_credentials.json    # √Ä PR√âSERVER de l'ancien projet
```

## üì¶ **STACK TECHNOLOGIQUE MODERNE**

### **D√©pendances principales (requirements.txt)**
```txt
# Core
python>=3.11
pydantic>=2.0.0
pyyaml>=6.0

# Data processing
pandas>=2.0.0
numpy>=1.24.0

# Web scraping
requests>=2.31.0
beautifulsoup4>=4.12.0
selenium>=4.15.0  # Si n√©cessaire pour JS

# Data analysis
scipy>=1.11.0
scikit-learn>=1.3.0

# Visualizations
plotly>=5.17.0

# API (optionnel)
fastapi>=0.104.0
uvicorn>=0.24.0

# Development
pytest>=7.4.0
black>=23.0.0
flake8>=6.1.0
```

## üîß **SP√âCIFICATIONS TECHNIQUES**

### **1. Scrapers natifs Python**
- **MTGO** : Scraping direct avec requests/BeautifulSoup
- **Melee** : API calls avec credentials existants (√Ä PR√âSERVER)
- **TopDeck** : Scraping direct
- **Cache intelligent** : √âviter re-scraping donn√©es existantes

### **2. Classification**
- **MTGOFormatData** : Utiliser les r√®gles officielles Badaro
- **Fallback** : Classification par couleurs si arch√©type non reconnu
- **Format** : Standard prioritaire, extensible autres formats

### **3. Analytics**
- **M√©triques essentielles** : Winrate, meta share, matchups
- **Statistiques** : Shannon diversity, trends temporels
- **Export** : JSON structur√© + CSV pour analyse

### **4. Visualizations**
- **Plotly moderne** : Graphiques interactifs
- **Dashboard HTML** : Page unique avec tous les graphiques
- **Responsive** : Compatible mobile/desktop

## üéØ **DONN√âES DE R√âF√âRENCE**

### **Format de sortie attendu (exemple)**
```json
{
  "analysis_period": "2025-07-01_2025-07-15",
  "format": "Standard",
  "total_decks": 1500,
  "total_tournaments": 45,
  "metagame": [
    {
      "archetype": "Izzet Prowess",
      "count": 180,
      "percentage": 12.0,
      "winrate": 0.58,
      "confidence_interval": [0.54, 0.62]
    }
  ],
  "matchups": {
    "Izzet Prowess vs Azorius Control": {
      "games": 25,
      "winrate": 0.64,
      "significance": "high"
    }
  }
}
```

## üö® **√âL√âMENTS √Ä PR√âSERVER DE L'ANCIEN PROJET**

### **Credentials Melee UNIQUEMENT**
- **Localisation** : `credentials/` dans ancien projet
- **Format** : JSON chiffr√©
- **CRITIQUE** : Ne pas perdre ces credentials

### **‚ö†Ô∏è LIBERT√â TOTALE POUR LE RESTE**
- **Pas de contraintes** sur MTGOFormatData (libre choix d'impl√©mentation)
- **Pas de format impos√©** pour les donn√©es de r√©f√©rence
- **Innovation encourag√©e** : nouvelles approches bienvenues

## üéØ **PLAN DE D√âVELOPPEMENT RECOMMAND√â**

### **Phase 1 : Structure (30min)**
1. Cr√©er structure projet propre
2. Configuration requirements.txt minimal
3. Point d'entr√©e main.py fonctionnel

### **Phase 2 : Scrapers (2h)**
1. Base scraper interface
2. MTGO scraper natif
3. Melee scraper avec credentials
4. Cache intelligent

### **Phase 3 : Pipeline (1h)**
1. Classification MTGOFormatData
2. Analytics de base
3. Export JSON structur√©

### **Phase 4 : Visualizations (1h)**
1. Graphiques Plotly essentiels
2. Dashboard HTML
3. Test complet pipeline

## üéØ **P√âRIODE DE TEST OBLIGATOIRE**

### **üìÖ DONN√âES DE R√âF√âRENCE JILLIAC**
- **P√©riode de test** : **1er juillet 2025 - 15 juillet 2025**
- **Format** : Standard uniquement
- **Objectif** : Reproduire exactement les r√©sultats Jilliac sur cette p√©riode
- **Comparaison** : L'utilisateur fournira les donn√©es Jilliac de r√©f√©rence pour validation

### **üö® TOUS LES TESTS DOIVENT √äTRE FAITS SUR CETTE P√âRIODE**
- Aucun autre test de p√©riode autoris√© avant validation
- Les r√©sultats doivent √™tre comparables aux donn√©es Jilliac
- M√©triques de validation : nombre de decks, arch√©types, winrates, matchups

## üéØ **CRIT√àRES DE SUCC√àS**

### **Fonctionnel**
- ‚úÖ Pipeline complet fonctionnel reproduisant les r√©sultats Jilliac
- ‚úÖ Donn√©es p√©riode 1-15 juillet 2025 identiques ou sup√©rieures √† Jilliac
- ‚úÖ Classification pr√©cise (>90% arch√©types reconnus)
- ‚úÖ **PAS D'INTERFACE UTILISATEUR** dans un premier temps - Focus sur les r√©sultats du pipeline uniquement

### **Technique**
- ‚úÖ Code propre et maintenable (<500 lignes par module)
- ‚úÖ D√©pendances minimales et claires
- ‚úÖ Tests unitaires de base
- ‚úÖ Documentation claire

### **Comparaison avec Jilliac (OBLIGATOIRE)**
- ‚úÖ M√™me qualit√© de donn√©es sur p√©riode 1-15 juillet 2025
- ‚úÖ Analyses √©quivalentes ou meilleures
- ‚úÖ R√©sultats du pipeline comparables (pas d'interface pour l'instant)

## üöÄ **INSTRUCTIONS POUR LA NOUVELLE IA**

1. **Lire ce brief compl√®tement**
2. **Confirmer compr√©hension de l'objectif**
3. **Proposer plan d√©taill√© phase par phase**
4. **Commencer par Phase 1 : Structure**
5. **Demander validation √† chaque √©tape**

## üìû **CONTACT & VALIDATION**

- **Utilisateur** : D√©veloppeur exp√©riment√© MTG Analytics
- **Attentes** : Code propre, architecture moderne, r√©sultats rapides
- **Style** : Pragmatique, efficace, pas de sur-engineering

---

*Document cr√©√© le : 2025-07-16*
*Objectif : Transition vers Manalytics-Clean*
*Status : Pr√™t pour nouvelle IA*
